# ウィジェット機能 テスト手順

## 重要：ウィジェットが動く環境

| 環境 | ウィジェット | アプリ本体 |
|------|-------------|------------|
| **Expo Go** | ❌ 動かない（ネイティブモジュールなし） | ✅ 動く |
| **Development Build / 本番ビルド** | ✅ 動く | ✅ 動く |

ウィジェットは **iOS のネイティブ拡張** のため、**Expo Go では表示・更新されません**。  
「ホーム画面にウィジェットを追加して同期が動くか」を確認するには、**EAS でビルドしたアプリ**を実機にインストールしてテストしてください。

---

## 1. Expo Go でできるテスト（アプリ側のみ）

- アプリの起動・4象限・カンバン・XY の切り替え
- Q1（重要×緊急）へのタスク追加・編集・削除・並び替え
- Q1 ラベルの編集
- 他象限へのドラッグ

→ ここまで問題なければ、**本番ビルド時にもウィジェットに渡すデータは同じ**なので、ビルド後にウィジェットが正しく表示される前提は満たせています。

---

## 2. ウィジェット自体をテストする手順（Development Build）

### 2.1 ビルドとインストール

```bash
cd C:\sticrix-expo
npx eas build --platform ios --profile development
```

ビルド完了後、リンクから .ipa を取得し、実機にインストール（TestFlight や 直接インストール）。

### 2.2 ホーム画面にウィジェットを追加

1. ホーム画面で **長押し** → 「ウィジェットを追加」
2. 一覧から **「Sticrix」** を選択
3. **小** または **中** サイズを選んで「ウィジェットを追加」

### 2.3 動作確認チェックリスト

| # | 操作 | 期待結果 |
|---|------|----------|
| 1 | アプリを開き、**4象限モード**で Q1 にタスクが 1 つ以上ある状態にする | ホーム画面のウィジェットに Q1 のタスクが表示される |
| 2 | アプリで Q1 のタスクの**文言を編集**して保存 | ウィジェットを表示し直すと、同じ文言に更新されている |
| 3 | アプリで Q1 に**新しいタスクを追加** | ウィジェットにそのタスクが現れる（小: 最大4件、中: 最大8件） |
| 4 | アプリで Q1 のタスクを**削除** | ウィジェットからそのタスクが消える |
| 5 | アプリで Q1 の**ラベル**（例:「重要×緊急」）を編集 | ウィジェットのタイトルがそのラベルに変わる |
| 6 | アプリで Q1 のタスクを**別の象限にドラッグ**して移動 | ウィジェットからそのタスクが消える |
| 7 | Q1 のタスクを**すべて削除** | ウィジェットに「No tasks」と表示される |

### 2.4 データの流れ（参考）

- アプリ: `App.js` で Q1 タスクと Q1 ラベルを `ReactNativeWidgetExtension.setWidgetData` / `setWidgetLabel` に渡す
- ネイティブ: `Module.swift` が App Group `group.com.yourname.sticrix` の UserDefaults に保存し、`WidgetCenter.shared.reloadAllTimelines()` を呼ぶ
- ウィジェット: `SticrixWidget.swift` の `SticrixProvider` が同じ App Group から読み取り、小/中サイズで表示

---

## 3. トラブルシュート

- **ウィジェットが「No tasks」のまま**  
  - アプリで 4象限モードにして、Q1（左上）にタスクがあるか確認  
  - アプリを一度終了してからウィジェットを再度表示してみる  

- **ウィジェットが更新されない**  
  - ホーム画面に戻る／ウィジェットが表示されている画面に戻ると、iOS がタイムラインを再取得することがある  
  - 何度かアプリで編集 → ホームに戻る を繰り返して確認  

- **Expo Go では「ウィジェット連携」が動かない**  
  - 仕様です。Development Build または本番ビルドでテストしてください。
